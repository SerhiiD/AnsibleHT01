---
# tasks file for bootstrap

- name: Update packages
  yum:
    name: '*'
    state: latest
    update_cache: yes
  when:
    - ansible_distribution == "CentOS"
  tags:
    - bootstrap
    - packages
    - bootstrap-packages

- name: Install packages
  yum:
    name: "{{ bootstrap_packages }}"
    state: latest
    update_cache: yes
  when:
    - ansible_distribution == "CentOS"
  tags:
    - bootstrap
    - packages
    - bootstrap-packages

- name: Put SELinux in permissive mode, logging actions that would be blocked.
  selinux:
    policy: targeted
    state: permissive
  tags:
    - bootstrap
    - configuration
    - bootstrap-configuration

- name: debug
  debug:
    msg: "{{ item.key }}: {{ item.value }}"
  with_dict: "{{ users_folders }}"
  tags:
    - bootstrap
    - debug
    - bootstrap-debug

- name: blocks which describes needed users, folders and order of folders owners
  block:
    - name: Add users
      user:
        name: "{{ item.key }}"
        state: present
      with_dict: "{{ users_folders }}"

    - name: create directories
      file:
        path: "{{ item.value }}"
        state: directory
        owner: "{{ item.key }}"
        mode: 0775
      with_dict: "{{ users_folders }}"
      when: item.value != None
  tags:
    - bootstrap
    - users
    - bootstrap-users